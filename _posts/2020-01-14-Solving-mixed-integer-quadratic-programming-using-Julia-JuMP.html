---
layout: post 
title: Solving mixed-integer quadratic programming (MIQP) using Julia+JuMP
categories: [programming] 
tags: [Julia]
comments: true 
---

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this blog, we will discuss how to solve a mixed-integer quadratic programming problem (MIQP) using <code>Julia</code> and <code>JuMP</code>. My versions of <code>Julia</code>, <code>JuMP</code>, and <code>Gurobi</code> are 1.3.0, 0.20.1, and 0.7.4, respectively. <!-- more --></p>
<p>As an illustrative example, we will consider the sparse regression problem. The sparse regression is a nonconvex optimization problem with applications to gene expression analysis and signal processing etc.</p>
<p><strong>Sparse regression problem.</strong>
The sparse regression problem is concerned with approximating a
vector $b\in\mathbf{R}^{m}$ with a linear combination of at most
$k$ columns of a matrix $A\in\mathbf{R}^{m\times n}$ with bounded
coefficients. The problem can be written as the following optimization
problem 
\begin{array}{ll}
\textrm{minimize} &amp; \|Ax-b\|^{2}\\
\textrm{subject to} &amp; \mathbf{card}(x)\leq k\\
 &amp; \|x\|_{\infty}\leq M,
\end{array}
where $x\in\mathbf{R}^{n}$ is the decision variable, and $A\in\mathbf{R}^{m\times n},b\in\mathbf{R}^{m},$
and $M\in\mathbf{R}$ are problem data. Here, $\mathbf{card}(x)$ is the number of nonzero components in $x$.</p>
<p><strong>Modeling sparse regression problem as a MIQP.</strong> The sparse regression problem  can be modeled as
the following MIQP: 
\begin{array}{ll}
\textrm{minimize} &amp; \|Ax-b\|^{2}\\
\textrm{subject to} &amp; |x_{i}|\leq My_{i},\quad i=1,\ldots,n \qquad (1)\\ 
 &amp; \sum_{i=1}^{n}y_{i}\leq k\\
 &amp; x\in\mathbf{R}^{n},y\in\{0,1\}^{n},
\end{array}
where $x, y$ are decision variables.</p>
<p>We can write our objective function as 
\begin{align*}
\|Ax-b\|^{2} &amp; =(Ax-b)^{\intercal}(Ax-b)\\
 &amp; =(x^{\intercal}A^{\intercal}-b^{\intercal})(Ax-b)\\
 &amp; =x^{\intercal}(A^{\intercal}A)x+(-2A^{\intercal}b)^{\intercal}x+\|b\|^{2},
\end{align*}
 which takes the function in a quadratic form.</p>
<p><strong>Rewriting the objective in a compatible format.</strong> If we define $S=A^{\intercal}A,$ $c=-2A^{\intercal}b,$ and $d=\|b\|^{2},$
then we can write the objective function as: 
$$
\sum_{i=1}^{n}\sum_{j=1}^{n}S_{ij}x_{i}x_{j}+\sum_{i=1}^{n}c_{i}x_{i}+d,
$$
 which is more compatible as an input for <code>JuMP</code>.</p>
<p><strong>Rewriting the bound constraint in a more compatible format.</strong> Also, for <code>JuMP</code>, we write the bound constraint $|x_{i}|\leq My_{i}$ as two constraints: $x_i \leq M y_i$, and $-M y_i \leq x_i$ for $i=1,\ldots,n$.</p>
<p>The code is as follows.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="c"># Load the necessary packages</span>
<span class="c"># ---------------------------</span>

<span class="k">using</span> <span class="n">Gurobi</span><span class="p">,</span> <span class="n">JuMP</span><span class="p">,</span> <span class="n">LinearAlgebra</span>
<span class="c"># if these packages are not installed then run:</span>
<span class="c"># using Pkg</span>
<span class="c"># Pkg.add(&quot;Gurobi&quot;)</span>
<span class="c"># Pkg.add(&quot;JuMP&quot;)</span>
<span class="c"># Also, keep in mind that Gurobi is a commercial solver, but it is free for academic use.</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="c"># Data, change it accordingly</span>
<span class="c"># ---------------------------</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="kt">Int64</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>

<span class="c"># Renaming a bunch of variables</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">A</span><span class="o">&#39;*</span><span class="n">A</span>
<span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="o">&#39;*</span><span class="n">b</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>3.511217774252138</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="c"># Define the model</span>
<span class="c"># ----------------</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">with_optimizer</span><span class="p">(</span><span class="n">Gurobi</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">))</span> <span class="c"># define name of the model, it could be anything, not necessarily &quot;model&quot;</span>

<span class="c"># Variables</span>
<span class="c"># ---------</span>

<span class="nd">@variable</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">])</span> <span class="c"># define variable x </span>

<span class="nd">@variable</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">],</span> <span class="n">Bin</span><span class="p">)</span> <span class="c"># define the binary variable y</span>

<span class="c"># Objective</span>
<span class="c"># ---------</span>

<span class="n">sense</span> <span class="o">=</span> <span class="n">MOI</span><span class="o">.</span><span class="n">MIN_SENSE</span> <span class="c"># by this command, we are programatically defining a quadratic objective to be minimized </span>

<span class="nd">@objective</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sense</span><span class="p">,</span> <span class="n">sum</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span> <span class="n">j</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span><span class="o">+</span> <span class="n">sum</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span> <span class="c"># define the objective</span>

<span class="c"># Constraints</span>
<span class="c"># ------------</span>

<span class="nd">@constraint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">con_lb</span><span class="p">[</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">],</span> <span class="o">-</span><span class="n">M</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c"># lower bound constraint</span>

<span class="nd">@constraint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">con_ub</span><span class="p">[</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">M</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c"># upper bound constraint</span>

<span class="nd">@constraint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">con_bd_sum</span><span class="p">,</span> <span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">)</span> <span class="c"># cardinality constraint in terms of y</span>

<span class="c"># Run the optimizer</span>
<span class="c"># -----------------</span>

<span class="n">status</span><span class="o">=</span><span class="n">optimize!</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="c"># time to optimize!</span>

<span class="c"># Let us look at the important outputs </span>
<span class="c"># ------------------------------------</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;******************************************************&quot;</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;optimal objective value is = &quot;</span><span class="p">,</span> <span class="n">objective_value</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;optimal x is = &quot;</span><span class="p">,</span>  <span class="n">value</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;optimal y is =&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Academic license - for non-commercial use only
Academic license - for non-commercial use only
Optimize a model with 21 rows, 20 columns and 50 nonzeros
Model has 55 quadratic objective terms
Variable types: 10 continuous, 10 integer (10 binary)
Coefficient statistics:
  Matrix range     [1e+00, 1e+00]
  Objective range  [6e-01, 7e+00]
  QObjective range [2e-02, 3e+01]
  Bounds range     [0e+00, 0e+00]
  RHS range        [2e+00, 2e+00]
Found heuristic solution: objective 3.5112178
Presolve time: 0.00s
Presolved: 21 rows, 20 columns, 50 nonzeros
Presolved model has 55 quadratic objective terms
Variable types: 10 continuous, 10 integer (10 binary)

Root relaxation: objective 1.776357e-15, 45 iterations, 0.00 seconds

    Nodes    |    Current Node    |     Objective Bounds      |     Work
 Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time

     0     0    0.00000    0    6    3.51122    0.00000   100%     -    0s
H    0     0                       1.5146229    0.00000   100%     -    0s
     0     0    0.00000    0    6    1.51462    0.00000   100%     -    0s
H    0     0                       0.9576732    0.00000   100%     -    0s
     0     2    0.00000    0    6    0.95767    0.00000   100%     -    0s
H   18     7                       0.7568978    0.59570  21.3%   4.8    0s

Explored 25 nodes (161 simplex iterations) in 0.02 seconds
Thread count was 8 (of 8 available processors)

Solution count 4: 0.756898 0.957673 1.51462 3.51122 

Optimal solution found (tolerance 1.00e-04)
Best objective 7.568977587066e-01, best bound 7.568977587066e-01, gap 0.0000%
******************************************************
optimal objective value is = 0.7568977587066126
optimal x is = [-1.0, 0.0, -0.9733324670061584, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
optimal y is =[1.0, -0.0, 1.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span>
</pre></div>

    </div>
</div>
</div>

</div>
 

