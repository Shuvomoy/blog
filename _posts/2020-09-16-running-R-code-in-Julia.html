---
layout: post 
title: Running R code in Julia
categories: [programming] 
tags: [Julia, R]
comments: true 
---

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this blog, we will show how to run <code>R</code> code in <code>Julia</code> using the package <code>RCall</code>. The jupyter notebook for this blog can be found <a href="https://raw.githubusercontent.com/Shuvomoy/blog/gh-pages/codes/running_R_code_in_Julia.ipynb">here.<!-- more --></a></p>
<p><code>R</code> has many convenient packages for statistics and data processing, so <code>RCall</code> gives us the flexibility of doing our data processing part in <code>R</code> without leaving the <code>Julia</code> environment. Then we can do the computation extensive part in <code>Julia</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Install the <code>RCall</code> package.</strong></p>
<p>We install the package <code>RCall</code> first in Julia. I am assuming that we have already installed <code>R</code> by following the instructions from this link <a href="https://www.r-project.org/">https://www.r-project.org/</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="c"># using Pkg  # Uncomment these two lines </span>
<span class="c"># Pkg.add(&quot;RCall&quot;) # if the RCall package is not installed</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">using</span> <span class="n">RCall</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>The macro to run <code>R</code> code in <code>Julia</code></strong></p>
<p>Any <code>R</code> code (it can be a large chuck of code) can be run in <code>Julia</code> using the macro</p>

<pre><code>  R"""
  code
  goes
  here
  """</code></pre>
<p>Best to understand it through example. We will run a a simple factor analysis model in <code>R</code> from <code>Julia</code>.</p>
<p>First, we download a dataset in <code>R</code> from <code>Julia</code> for doing factor analysis.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="c">## Download dataset from R</span>
<span class="n">R</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">food &lt;- read.csv(&quot;https://userpage.fu-berlin.de/soga/300/30100_data_sets/food-texture.csv&quot;,</span>
<span class="s">                 row.names = &quot;X&quot;)</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>RObject{VecSxp}
      Oil Density Crispy Fracture Hardness
B110 16.5    2955     10       23       97
B136 17.7    2660     14        9      139
B171 16.2    2870     12       17      143
B192 16.7    2920     10       31       95
B225 16.3    2975     11       26      143
B237 19.1    2790     13       16      189
B261 18.4    2750     13       17      114
B264 17.5    2770     10       26       63
B353 15.7    2955     11       23      123
B360 16.4    2945     11       24      132
B366 18.0    2830     12       15      121
B377 17.4    2835     12       18      172
B391 18.4    2860     14       11      170
B397 13.9    2965     12       19      169
B404 15.8    2930      9       26       65
B437 16.4    2770     15       16      183
B445 18.9    2650     14       20      114
B462 17.3    2890     12       17      142
B485 16.7    2695     13       13      111
B488 19.1    2755     14       10      140
B502 13.7    3000     10       27      177
B554 14.7    2980     10       20      133
B556 18.1    2780     13       14      150
B575 17.2    2705      8       27      113
B576 18.7    2825     13       20      166
B605 18.1    2875     12       15      150
B612 16.6    2945     10       25      100
B615 17.1    2920     10       25      123
B649 17.4    2845     13       19      129
B665 19.4    2645     12       18       68
B674 15.9    3080     10       23      106
B692 17.1    2825     10       28      131
B694 15.5    3125      7       33       92
B719 17.7    2780     13       22      141
B727 15.9    2900     12       21      192
B758 21.2    2570     14       13      105
B776 19.5    2635     13       22      101
B799 20.5    2725     14       16      145
B836 17.0    2865     11       22      100
B848 16.7    2975     10       26      105
B861 16.8    2980     10       24      144
B869 16.8    2870     12       20      123
B876 16.3    2920     11       22      136
B882 16.2    3100      8       27      140
B889 18.1    2910     12       21      120
B907 16.6    2865     11       25      120
B911 16.4    2995     12       20      165
B923 15.1    2925     10       29      118
B971 21.1    2700     13       16      116
B998 16.3    2845     10       26       75
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can bring back <code>food</code> from the <code>R</code> environment to the <code>Julia</code> environment using <code>@rget</code> macro. The copied variable will have the same name as the original.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="nd">@rget</span> <span class="n">food</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<table class="data-frame"><thead><tr><th></th><th>Oil</th><th>Density</th><th>Crispy</th><th>Fracture</th><th>Hardness</th></tr><tr><th></th><th>Float64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>50 rows × 5 columns</p><tr><th>1</th><td>16.5</td><td>2955</td><td>10</td><td>23</td><td>97</td></tr><tr><th>2</th><td>17.7</td><td>2660</td><td>14</td><td>9</td><td>139</td></tr><tr><th>3</th><td>16.2</td><td>2870</td><td>12</td><td>17</td><td>143</td></tr><tr><th>4</th><td>16.7</td><td>2920</td><td>10</td><td>31</td><td>95</td></tr><tr><th>5</th><td>16.3</td><td>2975</td><td>11</td><td>26</td><td>143</td></tr><tr><th>6</th><td>19.1</td><td>2790</td><td>13</td><td>16</td><td>189</td></tr><tr><th>7</th><td>18.4</td><td>2750</td><td>13</td><td>17</td><td>114</td></tr><tr><th>8</th><td>17.5</td><td>2770</td><td>10</td><td>26</td><td>63</td></tr><tr><th>9</th><td>15.7</td><td>2955</td><td>11</td><td>23</td><td>123</td></tr><tr><th>10</th><td>16.4</td><td>2945</td><td>11</td><td>24</td><td>132</td></tr><tr><th>11</th><td>18.0</td><td>2830</td><td>12</td><td>15</td><td>121</td></tr><tr><th>12</th><td>17.4</td><td>2835</td><td>12</td><td>18</td><td>172</td></tr><tr><th>13</th><td>18.4</td><td>2860</td><td>14</td><td>11</td><td>170</td></tr><tr><th>14</th><td>13.9</td><td>2965</td><td>12</td><td>19</td><td>169</td></tr><tr><th>15</th><td>15.8</td><td>2930</td><td>9</td><td>26</td><td>65</td></tr><tr><th>16</th><td>16.4</td><td>2770</td><td>15</td><td>16</td><td>183</td></tr><tr><th>17</th><td>18.9</td><td>2650</td><td>14</td><td>20</td><td>114</td></tr><tr><th>18</th><td>17.3</td><td>2890</td><td>12</td><td>17</td><td>142</td></tr><tr><th>19</th><td>16.7</td><td>2695</td><td>13</td><td>13</td><td>111</td></tr><tr><th>20</th><td>19.1</td><td>2755</td><td>14</td><td>10</td><td>140</td></tr><tr><th>21</th><td>13.7</td><td>3000</td><td>10</td><td>27</td><td>177</td></tr><tr><th>22</th><td>14.7</td><td>2980</td><td>10</td><td>20</td><td>133</td></tr><tr><th>23</th><td>18.1</td><td>2780</td><td>13</td><td>14</td><td>150</td></tr><tr><th>24</th><td>17.2</td><td>2705</td><td>8</td><td>27</td><td>113</td></tr><tr><th>25</th><td>18.7</td><td>2825</td><td>13</td><td>20</td><td>166</td></tr><tr><th>26</th><td>18.1</td><td>2875</td><td>12</td><td>15</td><td>150</td></tr><tr><th>27</th><td>16.6</td><td>2945</td><td>10</td><td>25</td><td>100</td></tr><tr><th>28</th><td>17.1</td><td>2920</td><td>10</td><td>25</td><td>123</td></tr><tr><th>29</th><td>17.4</td><td>2845</td><td>13</td><td>19</td><td>129</td></tr><tr><th>30</th><td>19.4</td><td>2645</td><td>12</td><td>18</td><td>68</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let us continue running our code in <code>R</code> environment. First, let us take a look at the correlation matrix of <code>food</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">R</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">Sigma &lt;- cor(food)</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>RObject{RealSxp}
                 Oil    Density     Crispy   Fracture    Hardness
Oil       1.00000000 -0.7500240  0.5930863 -0.5337392 -0.09604521
Density  -0.75002399  1.0000000 -0.6709460  0.5721324  0.10793720
Crispy    0.59308631 -0.6709460  1.0000000 -0.8439650  0.41109340
Fracture -0.53373917  0.5721324 -0.8439650  1.0000000 -0.37335844
Hardness -0.09604521  0.1079372  0.4110934 -0.3733584  1.00000000
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now run the factor analysis from <code>R</code> using the <code>factanal</code> function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">R</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">food_fa &lt;- factanal(covmat = Sigma, factors = 2)</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>RObject{VecSxp}

Call:
factanal(factors = 2, covmat = Sigma)

Uniquenesses:
     Oil  Density   Crispy Fracture Hardness 
   0.334    0.156    0.042    0.256    0.407 

Loadings:
         Factor1 Factor2
Oil      -0.816         
Density   0.919         
Crispy   -0.745   0.635 
Fracture  0.645  -0.573 
Hardness          0.764 

               Factor1 Factor2
SS loadings      2.490   1.316
Proportion Var   0.498   0.263
Cumulative Var   0.498   0.761

The degrees of freedom for the model is 1 and the fit was 0.006 
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As we can see in the output above, the <code>R</code> object <code>food_fa</code> has two chunks: <code>Uniquenesses</code>, <code>Loadings</code>. We can take a look at them from <code>R</code> using the following command.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">R</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">Lambda &lt;- food_fa</span><span class="si">$loadings</span><span class="s"></span>
<span class="s">D &lt;- diag(food_fa</span><span class="si">$uniquenesses</span><span class="s">)</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>RObject{RealSxp}
          [,1]      [,2]      [,3]      [,4]      [,5]
[1,] 0.3338599 0.0000000 0.0000000 0.0000000 0.0000000
[2,] 0.0000000 0.1555255 0.0000000 0.0000000 0.0000000
[3,] 0.0000000 0.0000000 0.0422238 0.0000000 0.0000000
[4,] 0.0000000 0.0000000 0.0000000 0.2560235 0.0000000
[5,] 0.0000000 0.0000000 0.0000000 0.0000000 0.4069459
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can bring back the variables: <code>Lambda</code>, <code>D</code> and <code>Sigma</code> in <code>Julia</code> using <code>@rget</code>, and perform residual analysis.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="nd">@rget</span> <span class="n">Lambda</span>
<span class="nd">@rget</span> <span class="n">D</span>
<span class="nd">@rget</span> <span class="n">Sigma</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>5×5 Array{Float64,2}:
  1.0        -0.750024   0.593086  -0.533739  -0.0960452
 -0.750024    1.0       -0.670946   0.572132   0.107937
  0.593086   -0.670946   1.0       -0.843965   0.411093
 -0.533739    0.572132  -0.843965   1.0       -0.373358
 -0.0960452   0.107937   0.411093  -0.373358   1.0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let us compare how good the residue is.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">Lambda</span><span class="o">*</span><span class="n">Lambda</span><span class="o">&#39;</span>
<span class="n">Sigma_fa</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">D</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>5×5 Array{Float64,2}:
  1.0        -0.750025   0.595699  -0.515519  -0.0952689
 -0.750025    1.0       -0.669865   0.579672   0.108257
  0.595699   -0.669865   1.0       -0.843965   0.411088
 -0.515519    0.579672  -0.843965   1.0       -0.373391
 -0.0952689   0.108257   0.411088  -0.373391   1.0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">Sigma_fa</span> <span class="o">-</span> <span class="n">Sigma</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>5×5 Array{Float64,2}:
 -3.32556e-7   -6.08148e-7    0.00261311   0.0182198    0.000776357
 -6.08148e-7   -3.0673e-8     0.00108144   0.00753941   0.000320227
  0.00261311    0.00108144   -1.18922e-9  -1.25235e-7  -4.98666e-6
  0.0182198     0.00753941   -1.25235e-7   1.37223e-7  -3.25606e-5
  0.000776357   0.000320227  -4.98666e-6  -3.25606e-5  -2.06679e-7</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Taking objects from <code>Julia</code> to <code>R</code></strong></p>
<p>What if we want to do the opposite, where we have an object in <code>Julia</code> that we want to move to <code>R</code> environment and run statistical analysis on <code>R</code>? We can do that using <code>@rput</code> macro. A simple example is as follows, where we take a <code>Julia</code> matrix <code>X</code> to <code>R</code> environment and find its svd. Of course, doing svd on <code>Julia</code> will be faster, so we do not want to do that in practice; this is just for illustration.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="nd">@rput</span> <span class="n">X</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>5×5 Array{Float64,2}:
  0.66614    -0.750025   0.595699  -0.515519  -0.0952689
 -0.750025    0.844474  -0.669865   0.579672   0.108257
  0.595699   -0.669865   0.957776  -0.843965   0.411088
 -0.515519    0.579672  -0.843965   0.743977  -0.373391
 -0.0952689   0.108257   0.411088  -0.373391   0.593054</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">R</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">X_svd &lt;- svd(X)</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>RObject{VecSxp}
$d
[1] 2.840147e+00 9.652738e-01 1.835730e-16 6.889660e-17 5.316257e-17

$u
           [,1]       [,2]        [,3]       [,4]        [,5]
[1,] -0.4318280  0.3760766  0.57192547 -0.2534798 -0.52984927
[2,]  0.4858567 -0.4246170 -0.06708423 -0.5805591 -0.49203098
[3,] -0.5613017 -0.2553929 -0.13261665 -0.6397742  0.43910886
[4,]  0.4919747  0.2420423  0.57970383 -0.2832291  0.53207255
[5,] -0.1427205 -0.7446186  0.56103230  0.3304079  0.03531956

$v
           [,1]       [,2]        [,3]        [,4]       [,5]
[1,] -0.4318280  0.3760766  0.24156539 -0.77208923 -0.1327229
[2,]  0.4858567 -0.4246170  0.65568309 -0.31382198  0.2350299
[3,] -0.5613017 -0.2553929  0.57315684  0.42583932 -0.3314618
[4,]  0.4919747  0.2420423  0.09751987  0.01599846 -0.8304278
[5,] -0.1427205 -0.7446186 -0.41678166 -0.35185069 -0.3573069

</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="nd">@rget</span> <span class="n">X_svd</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>OrderedCollections.OrderedDict{Symbol,Any} with 3 entries:
  :d =&gt; [2.84015, 0.965274, 1.83573e-16, 6.88966e-17, 5.31626e-17]
  :u =&gt; [-0.431828 0.376077 … -0.25348 -0.529849; 0.485857 -0.424617 … -0.58055…
  :v =&gt; [-0.431828 0.376077 … -0.772089 -0.132723; 0.485857 -0.424617 … -0.3138…</pre>
</div>

</div>

</div>
</div>

</div>
 

