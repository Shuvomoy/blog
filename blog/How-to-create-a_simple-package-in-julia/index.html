<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <link rel="stylesheet" href="/libs/katex/katex.min.css">
     
     <link rel="stylesheet" href="/libs/highlight/github.min.css">
   
    <link rel="stylesheet" href="/css/franklin.css">
<link rel="stylesheet" href="/css/tufte.css">
<link rel="stylesheet" href="/css/latex.css">
<link rel="stylesheet" href="/css/adjust.css"> <!-- sheet to overwrite some clashing styles -->
<link rel="icon" href="/assets/favicon.png">

     <title>How to create a simple package in Julia</title>  
</head>

<body>
<div id="layout">
  <div id="menu">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/tags/">Tags</a></li>
    </ul>
  </div>
  <div id="main">



<!-- Content appended here -->
<div class="franklin-content"><h1 id="how_to_create_a_simple_package_in_julia"><a href="#how_to_create_a_simple_package_in_julia" class="header-anchor">How to create a simple package in Julia</a></h1>
<p><strong>Shuvomoy Das Gupta</strong></p>
<p><em>March 22, 2020</em></p>
<blockquote>
<p>Thomson&#39;s Rule for First-Time Telescope Makers: <em>&quot;It is faster to make a four-inch mirror then a six-inch mirror than to make a six-inch mirror.&quot;</em></p>
</blockquote>
<p>In this blog, we discuss how to create a simple package in <code>Julia</code> that computes the proximal operator of a convex quadratic function. The goal is just to illustrate how to create a structured solver package, the code underlying the solver is very inefficient. Let us call our package <code>TestPackage</code>. </p>
<hr />
<p><strong>Table of contents</strong></p>
<div class="franklin-toc"><ol><li><a href="#step_0_the_inner_mechanism_of_the_package">Step 0. The inner mechanism of the package</a><ol><li><a href="#structure_of_the_package">Structure of the package</a></li></ol></li><li><a href="#step_1_ensure_git_and_github_are_set_up_properly">Step 1. Ensure <code>Git</code> and <code>Github</code> are set up properly</a></li><li><a href="#step_2_install_a_few_helpful_packages_for_package_development">Step 2. Install a few helpful packages for package development</a></li><li><a href="#step_3_create_the_blank_package_testpackage_using_pkgtemplates">Step 3. Create the blank package <code>TestPackage</code> using <code>PkgTemplates</code></a></li><li><a href="#step_4_create_the_julia_files">Step 4. Create the julia files</a><ol><li><a href="#files_in_src_folder">Files in <code>src</code> folder ##</a></li><li><a href="#files_in_test_folder">Files in <code>test</code> folder</a></li></ol></li><li><a href="#step_5_test_the_package_and_upload_the_files_to_github">Step 5. Test the package and upload the files to Github</a></li></ol></div>
<hr />
<p>We will go through the following 6 steps in order to create a fully functioning package in Julia:</p>
<ul>
<li><p>Step 0. The inner mechanism of the package</p>
</li>
<li><p>Step 1. Ensure <code>Git</code> and <code>Github</code> are set up properly</p>
</li>
<li><p>Step 2. Install a few helpful packages for package development</p>
</li>
<li><p>Step 3. Create the blank package <code>TestPackage</code> using <code>PkgTemplates</code></p>
</li>
<li><p>Step 5. Test the package and upload the files to Github</p>
</li>
</ul>
<p>Now let us take a look at the steps in detail.</p>
<h3 id="step_0_the_inner_mechanism_of_the_package"><a href="#step_0_the_inner_mechanism_of_the_package" class="header-anchor">Step 0. The inner mechanism of the package</a></h3>
<p>In this step, we take a look at what our package is intended to do. We are given a quadratic function \(f(x) = \frac{1}{2}x^{T}Ax+b^{T}x+c\), where \(A \in \mathbf{R}^{n \times n}\) is a positive semidefinite matrix, \( b\in\mathbf{R}^{n} \) is a column vector, and \( c\in\mathbf{R} \) is a scalar. Our goal is to compute the proximal map of the function \(f\) at a point \(v\in\mathbf{R}^{n}\) for the parameter \(\gamma\in\mathbf{R}_{++}\), which is given by the following formula:</p>
\[
\mathbf{prox}_{\gamma f}(v)=(I+\gamma A)^{-1}(v-\gamma b).
\]
<h4 id="structure_of_the_package"><a href="#structure_of_the_package" class="header-anchor">Structure of the package</a></h4>
<p>We can structure our package in two parts: source code in the <code>src</code> folder, and a bunch of test files in the <code>test</code> folder. We will use a julia package named <code>PkgTemplates</code> that will create the aforementioned structure automatically for us. For now, let us just briefly take a look at the skeleton of our code.</p>
<p><strong>1. <code>src</code> folder</strong>: The <code>src</code> folder has the following parts.</p>
<ul>
<li><p><em><code>Types.jl</code></em> In this julia file, we store different data types to represent our problem data, parameter, and the output. The problem data essentially comprises of \(A,b,c\). We will construct a data type <code>testPackageProblem</code> that will contain these matrices. Then, in the proximal map computation we have the parameter \(\gamma\), which can be seen as a setting for our solver; we will create a data type called <code>testPackageSetting</code> that will contain this. Finally, our output vector will be stored in a data type named <code>testPackageResult</code>.</p>
</li>
<li><p><em><code>Utils.jl</code></em> This file contains a function for matrix inversion using the dependecy package <code>LinearAlgebra</code>.</p>
</li>
<li><p><em><code>TestPackage.jl</code></em> This is the main julia file corresponding to our package, indicated by its name. It will include both <code>Types.jl</code> and <code>Utils.jl</code>, and contain the main solver function called <code>solver_prox_quad</code>.</p>
</li>
</ul>
<p><strong>2. <code>test</code> folder</strong>: The test folder has file called <code>runtests.jl</code>, where we run our solver to different test datasets and see if everything is working as expected.</p>
<h3 id="step_1_ensure_git_and_github_are_set_up_properly"><a href="#step_1_ensure_git_and_github_are_set_up_properly" class="header-anchor">Step 1. Ensure <code>Git</code> and <code>Github</code> are set up properly</a></h3>
<p>Our package is going to reside in <code>Github</code> for version control purpose, so we need to create a free account first. Also, for version control, we need to have <code>git</code> installed on our computer as well. A very good instruction on how to perform these steps can be found <a href="https://julia.quantecon.org/more_julia/version_control.html">here</a>.</p>
<h3 id="step_2_install_a_few_helpful_packages_for_package_development"><a href="#step_2_install_a_few_helpful_packages_for_package_development" class="header-anchor">Step 2. Install a few helpful packages for package development</a></h3>
<p>Two very nice packages that can facilitate our package development by a significant margin are <code>PkgTemplates</code> and <code>Revise</code>. We install both packages first from Julia REPL.</p>
<pre><code class="language-julia">using Pkg</code></pre>
<pre><code class="language-julia">Pkg.add&#40;&quot;PkgTemplates&quot;&#41;</code></pre>
<pre><code class="language-julia">Pkg.add&#40;&quot;Revise&quot;&#41;</code></pre>
<p>A very convenient thing to do is to load <code>Revise</code> during startup. For this, please follow the instructions at this <a href="https://timholy.github.io/Revise.jl/stable/config/#Using-Revise-by-default-1">link</a>.</p>
<h3 id="step_3_create_the_blank_package_testpackage_using_pkgtemplates"><a href="#step_3_create_the_blank_package_testpackage_using_pkgtemplates" class="header-anchor">Step 3. Create the blank package <code>TestPackage</code> using <code>PkgTemplates</code></a></h3>
<pre><code class="language-julia">using PkgTemplates</code></pre>
<p>Now create a specific template for our project.</p>
<pre><code class="language-julia">template &#61; Template&#40;user &#61; &quot;shuvomoy&quot;&#41; # change it to your specification</code></pre>
<p>Now let us generate the package &#40;empty for now&#41;.</p>
<pre><code class="language-julia">generate&#40;&quot;TestPackage&quot;, template&#41;</code></pre>
<p>As seen in the output above, the package is located at the folder <code>C:\Users\shuvo\.julia\dev\TestPackage</code>, copy this location; we are going to use it soon.</p>
<p><strong>Adding the project to the Julia Package Manager.</strong> We need to go through the following steps, so that Julia&#39;s package manager knows about our project.</p>
<p>First, in the Julia REPL type the following: </p>
<pre><code class="language-julia">cd&#40;&quot;C:\\Users\\shuvo\\.julia\\dev\\TestPackage&quot;&#41;
# alternatively The following will also work
# cd&#40;joinpath&#40;DEPOT_PATH&#91;1&#93;, &quot;dev&quot;, &quot;TestPackage&quot;&#41;&#41;</code></pre>
<pre><code class="language-julia">&#93; activate # this will get us into the main Julia environment</code></pre>
<pre><code class="language-julia">&#93; dev . # this adds our package TestPackage</code></pre>
<pre><code class="language-julia">&#93; st # this is to see the change in our default package list</code></pre>
<h3 id="step_4_create_the_julia_files"><a href="#step_4_create_the_julia_files" class="header-anchor">Step 4. Create the julia files</a></h3>
<h4 id="files_in_src_folder"><a href="#files_in_src_folder" class="header-anchor">Files in <code>src</code> folder ##</a></h4>
<p><strong>Description of <code>Utils.jl</code></strong></p>
<p>Create a file named <code>Utils.jl</code> in the <code>src</code> folder and copy the following code into it.</p>
<pre><code class="language-julia"># create a file named Utils.jl and copy the following code
import LinearAlgebra # note that we are using another package LinearAlgebra in our file,
# so we need to add this package to the list of dependencies for our package

function mat_inv&#40;A&#41;
    return LinearAlgebra.pinv&#40;A&#41;
end</code></pre>
<p>Note that in the code above, we have used the package <code>LinearAlgebra</code>. So, we need to add this package to the list of dependencies for our package. We can do that as follows.</p>
<pre><code class="language-julia">&#93; activate TestPackage</code></pre>
<pre><code class="language-julia">&#93; add LinearAlgebra</code></pre>
<p>To quit the active environment and return to the base again we can run the following.</p>
<pre><code class="language-julia">&#93; activate</code></pre>
<p><strong>Description of <code>Types.jl</code></strong></p>
<p>Create a file named <code>Types.jl</code> in the <code>src</code> folder and copy the following code into it.</p>
<pre><code class="language-julia"># testPackageResult represents the result
struct testPackageResult
    x::Array&#123;Float64&#125;
end

# testPackageProblem contains the problem data

mutable struct testPackageProblem
    A::Array&#123;Float64,2&#125;
    b::Array&#123;Float64&#125;
    c::Float64
    # constructor
    function testPackageProblem&#40;A,b,c&#41;
        new&#40;A,b,c&#41;
    end
end

# testPackageSetting contains the problem setting, i.e., the parameter γ as set by the user

struct testPackageSetting
    γ::Float64
    # constructor
    function testPackageSetting&#40;;γ &#61; 1&#41;
        new&#40;γ&#41;
    end
end</code></pre>
<p><strong>Description of <code>TestPackage.jl</code></strong></p>
<p>Create <code>TestPackage.jl</code> file in the <code>src</code> folder, and copy the following code in the file. Note that we are including both <code>Types.jl</code> and <code>Utils.jl</code> and exporting the name of contents, so that when we invoke <code>using TestPackage</code>, we can use those functions.</p>
<pre><code class="language-julia">module TestPackage

include&#40;&quot;./Types.jl&quot;&#41;

export testPackageResult, testPackageProblem, testPackageSetting # so that the user can uses the types from the main module, see how to use this types in runtest.jl

include&#40;&quot;./Utils.jl&quot;&#41;

export mat_inv # so that the we can use the functions from the main module

function solver_prox_quad&#40;v, problem::testPackageProblem, setting::testPackageSetting&#41;
    # extract the problem data
    A &#61; problem.A
    b &#61; problem.b
    c &#61; problem.c
    # extract the problem settings
    γ &#61; setting.γ
    # compute the proximal parameter
    mat_prox_quad &#61; LinearAlgebra.pinv&#40;LinearAlgebra.I &#43; γ*A&#41;
    prox_quad_v &#61; mat_prox_quad*&#40;v-γ*b&#41;
    return prox_quad_v
end

export solver_prox_quad

end # module</code></pre>
<h4 id="files_in_test_folder"><a href="#files_in_test_folder" class="header-anchor">Files in <code>test</code> folder</a></h4>
<p>Now that we have created the basic files for our package in the <code>src</code> folder, it is time now to test our code. To that goal, we create a file named <code>runtests.jl</code> in the <code>test</code> folder, where we have the following code.</p>
<pre><code class="language-julia">#### Files in &#96;test&#96; folder ##
using TestPackage
using Test

@testset &quot;testing for a certain set of data&quot; begin
    # Write your own tests here.
    A &#61; &#91; 2.67485     0.186124   0.583946  -0.145416   0.401269;
    -0.17813     0.526082  -0.325439  -1.46627   -3.09161 ;
    -1.52653    -0.631375  -0.618636  -2.36654    0.291429;
    -0.609349   -1.0533    -0.323403   1.34789   -0.409167;
    0.0687345  -0.946264  -0.118661  -1.49908   -1.30312&#93;

    A &#61; A*A&#39;

    A &#61; &#40;A&#43;A&#39;&#41;/2

    b &#61; &#91; 0.38052039048801956 ;
    0.5554436732038299 ;
    1.7334160203093987 ;
    0.4470254916964832 ;
    1.7676230141050555&#93;

    c &#61; 1.0

    v &#61; ones&#40;5&#41;

    problem_data &#61; testPackageProblem&#40;A, b, c&#41;

    problem_setting &#61; testPackageSetting&#40;γ &#61; 2.0&#41;

    result_approx &#61; &#91;0.10055689253917299, 0.24322623669390434, 0.0693976149433379, 0.09597235131516035, -0.530323239453701&#93;

    @test solver_prox_quad&#40;v, problem_data, problem_setting&#41; ≈ result_approx

end

# we can potentially create more matrices like that</code></pre>
<h3 id="step_5_test_the_package_and_upload_the_files_to_github"><a href="#step_5_test_the_package_and_upload_the_files_to_github" class="header-anchor">Step 5. Test the package and upload the files to Github</a></h3>
<p>Now we are in a position to test our package. We can do that in one of the following ways. We can just run the <code>runtests.jl</code> file from an editor such as Atom, and run it by pressing <code>shift-enter</code>.</p>
<p>Another way is open the Julia REPL, and run the following code.</p>
<pre><code class="language-julia">&#93; test TestPackage</code></pre>
<p>So, everything is working fine&#33;</p>
<p><strong>Add the package to Github.</strong> Now, we just add our package to Git version control system. Go to your Github account, create a new repository with name <code>TestPackage.jl</code>. In the package creation page, please keep the boxes unchecked for the <code>README.md</code>, <code>LICENSE</code>, and <code>.gitignore</code>, because these are already taken care of when we created our package using <code>PkgTemplates</code>. Next, drag and drop the folder from our <code>~/.julia/dev</code> directory &#40;to be specific, the contents of the folder <code>C:\Users\shuvo\.julia\dev\TestPackage</code>&#41; to Github desktop. The final step is to click the <code>publish branch</code> button to upload our files to Github.</p>
<p>We are done creating a simple working Julia package&#33;</p>
<div class="page-foot">
  <div class="copyright">
    &copy; Shuvomoy Das Gupta. Last modified: May 19, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
        </div> <!-- end of id=main -->
    </div> <!-- end of id=layout -->
    
        <script src="/libs/katex/katex.min.js"></script>
<script src="/libs/katex/auto-render.min.js"></script>
<script>renderMathInElement(document.body)</script>

    
    
        <script src="/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>
</html>
