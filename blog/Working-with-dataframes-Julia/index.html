<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
     <link rel="stylesheet" href="/libs/highlight/github.min.css">
   
    <link rel="stylesheet" href="/css/franklin.css">
<link rel="stylesheet" href="/css/tufte.css">
<link rel="stylesheet" href="/css/latex.css">
<link rel="stylesheet" href="/css/adjust.css"> <!-- sheet to overwrite some clashing styles -->
<link rel="icon" href="/assets/favicon.png">

     <title>Working with dataframes in Julia</title>  
</head>

<body>
<div id="layout">
  <div id="menu">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/tags/">Tags</a></li>
    </ul>
  </div>
  <div id="main">



<!-- Content appended here -->
<div class="franklin-content"><h1 id="working_with_dataframes_in_julia"><a href="#working_with_dataframes_in_julia" class="header-anchor">Working with dataframes in Julia</a></h1>
<p><strong>Shuvomoy Das Gupta</strong></p>
<p><em>May 5, 2020</em></p>
<p>In this blog, we will discuss how to work with dataframes using the <code>DataFrames</code> package in <code>Julia</code>. As an illustrative example, we will work with the MovieLens dataset. This is an introductory blog, and for learning how to use the <code>DataFrames</code> package in greater details, a great set of tutorials is available with jupyter notebooks at <a href="https://github.com/bkamins/Julia-DataFrames-Tutorial/">this link</a>.</p>
<hr />
<p><strong>Table of contents</strong></p>
<div class="franklin-toc"><ol><li><a href="#putting_the_data_into_dataframes">Putting the data into dataframes</a></li><li><a href="#converting_a_dataframe_into_wide_format">Converting a dataframe into wide format</a></li><li><a href="#working_with_missing_values">Working with missing values</a></li><li><a href="#saving_and_loading_dataframe">Saving and loading dataframe</a></li><li><a href="#converting_a_dataframe_into_a_matrix">Converting a dataframe into a matrix</a></li></ol></div>
<hr />
<p><strong>Jupyter notebook for this blog.</strong> The jupyter notebook for this blog can be downloaded from <a href="https://raw.githubusercontent.com/Shuvomoy/blog/gh-pages/codes/working_with_dataframes_intro_Julia.ipynb">this link</a> and the data files in zip format are available <a href="https://github.com/Shuvomoy/blog/blob/gh-pages/data/movielens_datasets.zip">here</a>. Please unzip them in the folder, where your ipynb or julia file is.</p>
<p><strong>What is the MovieLens dataset?</strong> The <code>MovieLens</code> dataset is one of the most common datasets people use for testing recommendation system algorithm. The version I will work with contains 1,000,209 ratings for approximately 3,900 movies; these recommendations were made by 6,040 MovieLens users. </p>
<p>Let us start with the necessary packages. </p>
<pre><code class="language-julia">using CSV, DataFrames</code></pre>
<p>First, let us check if the files are loaded correctly. The files are available here: <strong>Provide the link</strong>.</p>
<pre><code class="language-julia"># First, let us check if the files are loaded correctly
cd&#40;&quot;C:\\Users\\shuvo\\Desktop\\MovieLensDataSet_Experiment&quot;&#41;
isfile.&#40;&#91;&quot;users.csv&quot; &quot;movies.csv&quot; &quot;ratings.csv&quot;&#93;&#41;</code></pre>
<p>1×3 BitArray&#123;2&#125;:
 1  1  1</p>
<h3 id="putting_the_data_into_dataframes"><a href="#putting_the_data_into_dataframes" class="header-anchor">Putting the data into dataframes</a></h3>
<p>Let us put the data into dataframes.</p>
<pre><code class="language-julia"># put the data in dataframes
df_users &#61; CSV.read&#40;&quot;users.csv&quot;&#41;;
df_movies &#61; CSV.read&#40;&quot;movies.csv&quot;&#41;;
df_ratings &#61; CSV.read&#40;&quot;ratings.csv&quot;&#41;;</code></pre>
<p><strong>The <code>df_users</code> dataframe.</strong> Let us briefly explore the contents of the <code>df_users</code> dataframe. </p>
<pre><code class="language-julia">size&#40;df_users&#41;</code></pre>
<p>&#40;6040, 8&#41;</p>
<p>So, <code>df_users</code> has 6040 rows and 8 columns. It is too large, but let us peek into the first and last few of the rows rows.</p>
<pre><code class="language-julia">first&#40;df_users,3&#41;</code></pre>



<table class="data-frame"><thead><tr><th></th><th>Column1</th><th>user_id</th><th>gender</th><th>age</th><th>occupation</th><th>zipcode</th><th>age_desc</th><th>occ_desc</th></tr><tr><th></th><th>Int64</th><th>Int64</th><th>String</th><th>Int64</th><th>Int64</th><th>String</th><th>String</th><th>String</th></tr></thead><tbody><p>3 rows × 8 columns</p><tr><th>1</th><td>0</td><td>1</td><td>F</td><td>1</td><td>10</td><td>48067</td><td>Under 18</td><td>K-12 student</td></tr><tr><th>2</th><td>1</td><td>2</td><td>M</td><td>56</td><td>16</td><td>70072</td><td>56+</td><td>self-employed</td></tr><tr><th>3</th><td>2</td><td>3</td><td>M</td><td>25</td><td>15</td><td>55117</td><td>25-34</td><td>scientist</td></tr></tbody></table>



<pre><code class="language-julia">last&#40;df_users, 4&#41;</code></pre>




<table class="data-frame"><thead><tr><th></th><th>Column1</th><th>user_id</th><th>gender</th><th>age</th><th>occupation</th><th>zipcode</th><th>age_desc</th><th>occ_desc</th></tr><tr><th></th><th>Int64</th><th>Int64</th><th>String</th><th>Int64</th><th>Int64</th><th>String</th><th>String</th><th>String</th></tr></thead><tbody><p>4 rows × 8 columns</p><tr><th>1</th><td>6036</td><td>6037</td><td>F</td><td>45</td><td>1</td><td>76006</td><td>45-49</td><td>academic/educator</td></tr><tr><th>2</th><td>6037</td><td>6038</td><td>F</td><td>56</td><td>1</td><td>14706</td><td>56+</td><td>academic/educator</td></tr><tr><th>3</th><td>6038</td><td>6039</td><td>F</td><td>45</td><td>0</td><td>01060</td><td>45-49</td><td>other or not specified</td></tr><tr><th>4</th><td>6039</td><td>6040</td><td>M</td><td>25</td><td>6</td><td>11106</td><td>25-34</td><td>doctor/health care</td></tr></tbody></table>


<p>Now let us take a look at the basic summary statistics of data in df_users.</p>
<pre><code class="language-julia"># Let us take a look at a quick summary about df_users for a few users
describe&#40;df_users, cols &#61; 1:3&#41;
# if we were interested about all the columns, then we could run the following command:
# describe&#40;df_users&#41;</code></pre>

<table class="data-frame"><thead><tr><th></th><th>variable</th><th>mean</th><th>min</th><th>median</th><th>max</th><th>nunique</th><th>nmissing</th><th>eltype</th></tr><tr><th></th><th>Symbol</th><th>Union…</th><th>Any</th><th>Union…</th><th>Any</th><th>Union…</th><th>Nothing</th><th>DataType</th></tr></thead><tbody><p>3 rows × 8 columns</p><tr><th>1</th><td>Column1</td><td>3019.5</td><td>0</td><td>3019.5</td><td>6039</td><td></td><td></td><td>Int64</td></tr><tr><th>2</th><td>user_id</td><td>3020.5</td><td>1</td><td>3020.5</td><td>6040</td><td></td><td></td><td>Int64</td></tr><tr><th>3</th><td>gender</td><td></td><td>F</td><td></td><td>M</td><td>2</td><td></td><td>String</td></tr></tbody></table>

<p>The get the name of all the columns of <code>df_users</code>, we can use the function <code>names</code>. </p>
<pre><code class="language-julia">names&#40;df_users&#41;</code></pre>
<p>8-element Array&#123;Symbol,1&#125;:
 :Column1   
 :user_id   
 :gender    
 :age       
 :occupation
 :zipcode   
 :age_desc  
 :occ_desc</p>
<p>If we want to know the element types of each column, we can run the following.</p>
<pre><code class="language-julia">eltype.&#40;eachcol&#40;df_users&#41;&#41;</code></pre>
<p>8-element Array&#123;DataType,1&#125;:
 Int64 
 Int64 
 String
 Int64 
 Int64 
 String
 String
 String</p>
<p><strong>The <code>df_movies</code> dataframe.</strong> Let us repeat the previous commands for the <code>df_movies</code> dataframe.</p>
<pre><code class="language-julia">size&#40;df_movies&#41;;</code></pre>
<pre><code class="language-julia">first&#40;df_movies,5&#41;;</code></pre>
<pre><code class="language-julia">last&#40;df_movies, 3&#41;;</code></pre>
<pre><code class="language-julia">describe&#40;df_movies, cols &#61; 1:3&#41;;</code></pre>
<pre><code class="language-julia">names&#40;df_movies&#41;</code></pre>
<p>4-element Array&#123;Symbol,1&#125;:
 :Column1 
 :movie_id
 :title   
 :genres</p>
<pre><code class="language-julia">eltype.&#40;eachcol&#40;df_movies&#41;&#41;;</code></pre>
<p><strong>The <code>df_ratings</code> dataframe.</strong> Let us see what is going on with the dataframe <code>df_ratings</code>.</p>
<pre><code class="language-julia">size&#40;df_ratings&#41;; # quite large with 1000209 columns and 7 rows</code></pre>
<pre><code class="language-julia">first&#40;df_ratings,3&#41;</code></pre>

<table class="data-frame"><thead><tr><th></th><th>Column1</th><th>user_id</th><th>movie_id</th><th>rating</th><th>timestamp</th><th>user_emb_id</th><th>movie_emb_id</th></tr><tr><th></th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>3 rows × 7 columns</p><tr><th>1</th><td>0</td><td>1</td><td>1193</td><td>5</td><td>978300760</td><td>0</td><td>1192</td></tr><tr><th>2</th><td>1</td><td>1</td><td>661</td><td>3</td><td>978302109</td><td>0</td><td>660</td></tr><tr><th>3</th><td>2</td><td>1</td><td>914</td><td>3</td><td>978301968</td><td>0</td><td>913</td></tr></tbody></table>

<pre><code class="language-julia">last&#40;df_ratings,3&#41;;</code></pre>
<pre><code class="language-julia">describe&#40;df_ratings, cols &#61; 1:3&#41;;</code></pre>
<pre><code class="language-julia">names&#40;df_ratings&#41;;</code></pre>
<pre><code class="language-julia">eltype.&#40;eachcol&#40;df_ratings&#41;&#41;;</code></pre>
<pre><code class="language-julia">## Let us create the rating matrix
# first let us create the number of unique users and matrices
n_users &#61; length&#40;unique&#40;df_ratings.user_id&#41;&#41;
n_movies &#61; length&#40;unique&#40;df_ratings.movie_id&#41;&#41;
println&#40;&quot;Number of users &#61; &#36;&#40;n_users&#41; | Number of movies &#61; &#36;&#40;n_movies&#41;&quot;&#41;</code></pre>
<p>Number of users &#61; 6040 | Number of movies &#61; 3706</p>
<h3 id="converting_a_dataframe_into_wide_format"><a href="#converting_a_dataframe_into_wide_format" class="header-anchor">Converting a dataframe into wide format</a></h3>
<p>Now we construct a wide format dataframe for the <code>df_ratings</code> dataframe using the <code>unstack</code> function. Our goal is creating a dataframe, which will have the users as the rows, the movies as the columns, and the rating as the value. The <code>unstack</code> function requires specifying which columns would act as id variable, column variable name, and column values. </p>
<pre><code class="language-julia">df_ratings_unstacked &#61; unstack&#40;df_ratings, :user_id, :movie_id, :rating&#41;;</code></pre>
<pre><code class="language-julia">size&#40;df_ratings_unstacked&#41;</code></pre>
<p>&#40;6040, 3707&#41;</p>
<pre><code class="language-julia">first&#40;df_ratings_unstacked, 6&#41;</code></pre>

<table class="data-frame"><thead><tr><th></th><th>user_id</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th></tr><tr><th></th><th>Int64</th><th>Int64⍰</th><th>Int64⍰</th><th>Int64⍰</th><th>Int64⍰</th><th>Int64⍰</th><th>Int64⍰</th><th>Int64⍰</th><th>Int64⍰</th></tr></thead><tbody><p>6 rows × 3,707 columns (omitted printing of 3698 columns)</p><tr><th>1</th><td>1</td><td>5</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td></tr><tr><th>2</th><td>2</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td></tr><tr><th>3</th><td>3</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td></tr><tr><th>4</th><td>4</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td></tr><tr><th>5</th><td>5</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>2</td><td>missing</td><td>missing</td></tr><tr><th>6</th><td>6</td><td>4</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td><td>missing</td></tr></tbody></table>

<h3 id="working_with_missing_values"><a href="#working_with_missing_values" class="header-anchor">Working with missing values</a></h3>
<p>We have lot of missing values, which we can see the let us replace the missing values with <code>NaN</code>.</p>
<pre><code class="language-julia"># replace the missing values in the data frame
column_names_ru &#61; names&#40;df_ratings_unstacked&#41;;
for i in 1:length&#40;column_names_ru&#41;
   df_ratings_unstacked&#91;&#33;, column_names_ru&#91;i&#93;&#93; &#61; replace&#40;df_ratings_unstacked&#91;&#33;, column_names_ru&#91;i&#93;&#93;, missing &#61;&gt; NaN&#41; # If we want to replace the missing values with any other number, then we use: missing &#61;&gt; NaN
end</code></pre>
<p>Let us see if the values have indeed changed.</p>
<pre><code class="language-julia">first&#40;df_ratings_unstacked, 6&#41;</code></pre>

<table class="data-frame"><thead><tr><th></th><th>user_id</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th></tr></thead><tbody><p>6 rows × 3,707 columns (omitted printing of 3698 columns)</p><tr><th>1</th><td>1.0</td><td>5.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>2</th><td>2.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>3</th><td>3.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>4</th><td>4.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>5</th><td>5.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>2.0</td><td>NaN</td><td>NaN</td></tr><tr><th>6</th><td>6.0</td><td>4.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr></tbody></table>

<p><strong>What if the missing values are represented as some other symbol in the original dataframe?</strong> In the previous example, the missing values were convenienetly recognized by Julia as <code>missing</code> type. Now, in some data files the missing values are represented by some other symbols, such as &quot;?&quot;. In such case the column that contains &quot;?&quot; may be diagnosed as an array of strings by Julia. In that case, we could run the following command to replace the &quot;?&quot;s with <code>missing</code> using the following command.</p>
<pre><code class="language-julia">type_of_columns &#61; eltype.&#40;eachcol&#40;df&#41;&#41; # say the name of the dataframe is df

m, n &#61; size&#40;df&#41;

for i in 3:n # let the important columns containing missing values start from column number 3

  if type_of_columns&#91;i&#93; &#61;&#61; String # due to presence of &quot;?&quot; in the column, it may get diagnosed by an array of strings by Julia
  
          df&#91;&#33;, i&#93;  &#61; map&#40;x-&gt;
                         begin
                         val &#61; tryparse&#40;Float64, x&#41;
                         ifelse&#40;typeof&#40;val&#41; &#61;&#61; Nothing, missing, val&#41;                         
                         end, df&#91;&#33;,i&#93;&#41;
                         
  end
end</code></pre>
<h3 id="saving_and_loading_dataframe"><a href="#saving_and_loading_dataframe" class="header-anchor">Saving and loading dataframe</a></h3>
<p>Let us see how to load and safe a dataframe. We can save <code>df_ratings_unstacked</code> using the <code>write</code> function provided by the <code>CSV</code> package. </p>
<pre><code class="language-julia">CSV.write&#40;&quot;df_ratings_unstacked.csv&quot;, df_ratings_unstacked&#41;</code></pre>
<p>&quot;df_ratings_unstacked.csv&quot;</p>
<p>To load back the dataframe that we just saved into the csv file, we can use <code>read</code> command provided by <code>CSV</code> package. The command <code>use_mmap &#61; false</code> is used, so that the file can be deleted in the same session; this is required only in Windows.</p>
<pre><code class="language-julia">df_loaded &#61; CSV.read&#40;&quot;df_ratings_unstacked.csv&quot;, use_mmap&#61;false&#41;;
first&#40;df_loaded, 5&#41;</code></pre>

<table class="data-frame"><thead><tr><th></th><th>user_id</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th></tr></thead><tbody><p>5 rows × 3,707 columns (omitted printing of 3698 columns)</p><tr><th>1</th><td>1.0</td><td>5.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>2</th><td>2.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>3</th><td>3.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>4</th><td>4.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>5</th><td>5.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>2.0</td><td>NaN</td><td>NaN</td></tr></tbody></table>

<h3 id="converting_a_dataframe_into_a_matrix"><a href="#converting_a_dataframe_into_a_matrix" class="header-anchor">Converting a dataframe into a matrix</a></h3>
<p>Now let us convert the <code>df_ratings_unstacked</code> dataframe into a matrix.</p>
<pre><code class="language-julia">ratings_matrix &#61; df_ratings_unstacked&#91;:,  2:length&#40;column_names_ru&#41;&#93;;
rating_matrix &#61; convert&#40;Matrix, ratings_matrix&#41;</code></pre>
<pre><code class="language-julia">6040×3706 Array&#123;Float64,2&#125;:
       5.0  NaN    NaN    NaN    NaN    …  NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
       4.0  NaN    NaN    NaN    NaN    …  NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
       4.0  NaN    NaN      3.0  NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
       5.0  NaN    NaN    NaN    NaN       NaN  NaN    3.0  NaN  NaN  NaN  NaN
       5.0    5.0  NaN    NaN    NaN       NaN  NaN    4.0  NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN    …  NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN      3.0  NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
       ⋮                                ⋱         ⋮                          ⋮
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN      4.0  NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN    …  NaN  NaN  NaN    NaN  NaN  NaN  NaN
       4.0  NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
       4.0  NaN      1.0    2.0    1.0     NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN      2.0  NaN    …  NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
     NaN    NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN
       3.0  NaN    NaN    NaN    NaN       NaN  NaN  NaN    NaN  NaN  NaN  NaN</code></pre>
<div class="page-foot">
  <div class="copyright">
    &copy; Shuvomoy Das Gupta. Last modified: May 20, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->
        </div> <!-- end of id=main -->
    </div> <!-- end of id=layout -->
    
    
        <script src="/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>
</html>
