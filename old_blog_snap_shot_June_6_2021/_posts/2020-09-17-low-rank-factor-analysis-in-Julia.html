---
layout: post 
title: Low-rank factor analysis in Julia using Convex and COSMO
categories: [programming] 
tags: [Julia]
comments: true 
---

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this blog, we will discuss how to approximately solve low-rank factor analysis problem using the nuclear norm heuristic in <code>Julia</code> using the packages <code>Convex</code> and <code>COSMO</code>. The jupyter notebook for this blog can be downloaded <a href="https://raw.githubusercontent.com/Shuvomoy/blog/gh-pages/codes/factor_analysis_in_Julia.ipynb">here</a><!-- more -->.</p>
<p>Factor analysis is a very popular method in statistics that reduces
linear dimensionality of a particular model. The best way to understand
factor analysis is to consider a generative model.</p>
<h3 id="Basic-factor-analysis-model">Basic factor analysis model<a class="anchor-link" href="#Basic-factor-analysis-model">&#182;</a></h3><p>A basic factor
analysis model is of the form
$$
\begin{eqnarray}
x &amp; = &amp; Lf+\epsilon,
\end{eqnarray}
$$</p>
<p>where $x\in\mathbf{R}^{n}$ is the observed random vector, $f\in\mathbf{R}^{r}$
(with $r\leq n$) is a random vector of common factor variables or
scores, $L\in\mathbf{R}^{n\times r}$ is a matrix of factor loadings,
and $\epsilon\in\mathbf{R}^{n}$ is a vector of uncorrelated random
variables.</p>
<p>The observed random vector $x$ may contain series of achievement
tests, psychological evaluation, intellectual performance etc. Without
loss of generality, we assume that $x$ is mean-centered <em>i.e.</em>,
$\mathbf{E}(x)=0$, the vectors $f$ and $\epsilon$ are uncorrelated,
and the covariance matrix of $f$ is the identity matrix.</p>
<p>We will denote $\mathbf{cov}(\epsilon)=D=\mathbf{diag}(d_{1},d_{2},\ldots,d_{n}).$
Then the covariance matrix of $x$, denoted by $\Sigma$ can be written
as: 
$$
\Sigma=X+D,
$$
 where $X=LL^{T}$ is the covariance matrix corresponding to the common
factors. The statistical method of factor analysis involves looking
at $N$ samples generated by the model (1), <em>i.e.</em>, given $x_{1},\ldots,x_{N}$
generated by (1) we want to estimate the matrices $X$ and $D$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Optimization-problem-in-consideration">Optimization problem in consideration<a class="anchor-link" href="#Optimization-problem-in-consideration">&#182;</a></h3><p>The optimization problem to determine the matrices $X,D$ can be written
as:</p>
$$
\begin{equation}
\begin{array}{ll}
\textrm{minimize} &amp; \left\Vert \Sigma-X-D\right\Vert _{F}^{2}\\
\textrm{subject to} &amp; D=\mathbf{diag}(d)\\
 &amp; d\geq0\\
 &amp; X\succeq0\\
 &amp; \mathbf{rank}(X)\leq r\\
 &amp; \Sigma-D\succeq0\\
 &amp; \|X\|_{2}\leq M,
\end{array}
\end{equation}
$$<p>where $X\in\mathbf{S}^{n}$ and the diagonal matrix $D\in\mathbf{S}^{n}$
with nonnegative diagonal entries are the decision variables, and
$\Sigma\in\mathbf{S}_{+}^{n}$ (a positive semidefinite matrix), $r\in\mathbf{Z}_{+},$
and $M\in\mathbf{R}_{++}$ are the problem data. The term $r$ is called the number of factors for a factor analysis model.</p>
<p>A proper solution for the optimization problem above requires that
both $X$ and $D$ are positive semidefinite. Furthermore, when $\Sigma-D$,
which is the covariance matrix for the common parts of the variables,
is not positive semidefinite, that would as embarrassing as having
a negative unique variance in $D$, as noted by ten Berge <a href="https://link.springer.com/chapter/10.1007/978-3-642-72253-0_44">here, page 326</a>. To prevent the aforementioned undesriable situation we enforce the constraint $\Sigma-D\succeq0$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Nuclear-norm-heuristic">Nuclear norm heuristic<a class="anchor-link" href="#Nuclear-norm-heuristic">&#182;</a></h3><p>The optimization problem above is nonconvex. To approximately solve
it, we use the nuclear norm heuristic. In this heuristic, we solve
the following relaxed convex optimization problem:</p>
$$
\begin{array}{ll}
\textrm{minimize} &amp; \left\Vert \Sigma-X-D\right\Vert _{F}^{2}+\lambda\left\Vert X\right\Vert _{*}\\
\textrm{subject to} &amp; D=\mathbf{diag}(d)\\
 &amp; d\geq0\\
 &amp; X\succeq0\\
 &amp; \Sigma-D\succeq0\\
 &amp; \|X\|_{2}\leq M,
\end{array}
$$<p>where $\lambda$ is a positive parameter that is related to the rank
of the decision variable $X$. Note that, as $X$ is positive semidefinite,
we have $\|X\|_{*}=\mathbf{tr}(X).$</p>
<p>To compute the value of $\lambda$ corresponding to a desired $r$
such that $\mathbf{rank}(X)\leq r$ we solve the relaxed problem for
different values of $\lambda$, and find the smallest value of $\lambda$
for which we have $\mathbf{rank}(X)\leq r$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, we load the necessary packages.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">using</span> <span class="n">CSV</span>
<span class="k">using</span> <span class="n">DataFrames</span>
<span class="k">using</span> <span class="n">RCall</span>
<span class="k">using</span> <span class="n">LinearAlgebra</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Data-processing">Data processing<a class="anchor-link" href="#Data-processing">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First we load the <code>bfi</code> dataset, that contains  2800 observations on 28 variables (25 personality self-reported
items with 3 demographic variables). This dataset can be downloaded directly from <a href="https://osf.io/s87kd/download">https://osf.io/s87kd/download</a> in <code>.csv</code> format.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">present_dir</span> <span class="o">=</span> <span class="n">pwd</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&#34;C:\\Users\\shuvo\\Google Drive\\GitHub\\blog\\codes&#34;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="c">## Download the data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">download</span><span class="p">(</span><span class="s">&quot;https://osf.io/s87kd/download&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">(</span><span class="n">present_dir</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">bfi.csv&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&#34;C:\\Users\\shuvo\\Google Drive\\GitHub\\blog\\codes\\bfi.csv&#34;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">isfile</span><span class="p">(</span><span class="s">&quot;bfi.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>true</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">df_missing</span> <span class="o">=</span> <span class="n">CSV</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;bfi.csv&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dropmissing</span><span class="p">(</span><span class="n">df_missing</span><span class="p">);</span> <span class="c"># remove the missing entries from the dataframe, </span>
<span class="c"># as we just want to compute the correlation matris</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">describe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">28</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="nd">@rput</span> <span class="n">df</span><span class="p">;</span> <span class="c"># take the dataframe to R for computing correlation matrix</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">R</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">cor_df &lt;- cor(df)</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="p">;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="nd">@rget</span> <span class="n">cor_df</span> <span class="c"># take the correlation matrix back to Julia</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>28×28 Array{Float64,2}:
  1.0         -0.340197   -0.263031    …  -0.136587    -0.136628
 -0.340197     1.0         0.484847        0.0205305    0.0907473
 -0.263031     0.484847    1.0             0.00302212   0.0422701
 -0.143494     0.342175    0.376834       -0.0194045    0.114304
 -0.186059     0.382181    0.502886        0.0152653    0.10128
  0.0199475    0.0916727   0.101067    …   0.0397446    0.0817625
  0.0135432    0.125589    0.144902        0.0111422   -0.000663161
 -0.00944154   0.185624    0.132825        0.059661     0.0510965
  0.0999505   -0.1391     -0.116813       -0.0352572   -0.118543
  0.0241364   -0.110892   -0.14657         0.0411726   -0.0726914
  0.119356    -0.236445   -0.216643    …   0.0014964   -0.0329892
  0.083675    -0.241833   -0.289279       -0.013504    -0.104449
 -0.0443058    0.24852     0.383903        0.00653258  -0.0246661
  ⋮                                    ⋱               
  0.131985    -0.0385061  -0.0835136      -0.0374677   -0.0899983
  0.0883465   -0.02043    -0.0285598      -0.0398315   -0.11137
  0.0442358   -0.0862298  -0.132673        0.0141758   -0.0249228
  0.00794603   0.024141   -0.0403648      -0.0467792   -0.100556
  0.00252215   0.108006    0.14099     …   0.0346312    0.0498059
  0.0663183    0.0324443   0.030827       -0.101792    -0.0443032
 -0.0623915    0.146559    0.215028        0.0965583    0.0243977
 -0.0895899    0.053878    0.0242059       0.0606762    0.000970633
  0.108565    -0.0794404  -0.0372134      -0.0589895   -0.0847787
 -0.167228     0.208288    0.156942    …   0.00572965   0.0469753
 -0.136587     0.0205305   0.00302212      1.0          0.249114
 -0.136628     0.0907473   0.0422701       0.249114     1.0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This matrix <code>cor_df</code> will act as the matrix $\Sigma$ in our optimization problem.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Solving-the-optimization-problem">Solving the optimization problem<a class="anchor-link" href="#Solving-the-optimization-problem">&#182;</a></h3><p>Now we set the data to approximately solve the factor analysis problem using nuclear norm heuristic. In this case, we take the number of factors $r$ to be half of the rank of $\Sigma$. In practice, it will be set by the user.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">Σ</span> <span class="o">=</span> <span class="n">cor_df</span>
<span class="n">max_r</span> <span class="o">=</span> <span class="n">rank</span><span class="p">(</span><span class="n">Σ</span> <span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">opnorm</span><span class="p">(</span><span class="n">Σ</span> <span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">max_r</span><span class="o">/</span><span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>14.0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="c"># Load the packages for optimization</span>
<span class="k">using</span> <span class="n">Convex</span>
<span class="k">using</span> <span class="n">COSMO</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">minimimum_trace_factanal</span><span class="p">(</span><span class="n">Σ</span><span class="p">,</span><span class="n">λ</span><span class="p">)</span>
  
  <span class="c"># Data</span>
  <span class="c"># ----</span>
  <span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">Σ</span><span class="p">)</span>
  
  <span class="c"># Create the variables</span>
  <span class="c"># --------------------</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">Convex</span><span class="o">.</span><span class="n">Semidefinite</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c"># Means variable X is positive semidefinite</span>
  <span class="n">d</span> <span class="o">=</span> <span class="n">Convex</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="n">D</span> <span class="o">=</span> <span class="n">diag</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> 
  
  <span class="c"># Create the terms of the objective functions</span>
  <span class="c"># -------------------------------------------</span>
  <span class="n">t1</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="n">norm2</span><span class="p">(</span><span class="n">Σ</span> <span class="o">-</span> <span class="n">X</span> <span class="o">-</span> <span class="n">D</span><span class="p">))</span> <span class="c"># norm2 computes the Frobenius norm of a matrix in Convex.jl</span>
  <span class="n">t2</span> <span class="o">=</span> <span class="n">λ</span><span class="o">*</span><span class="n">tr</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c"># because X is a psd semidefinite matrix, its nuclear norm is equal to its trace</span>
  
  <span class="c"># Create objective</span>
  <span class="c"># ----------------</span>
  <span class="n">objective</span> <span class="o">=</span> <span class="n">t1</span><span class="o">+</span><span class="n">t2</span>
  
  <span class="c"># Create the problem instance and add the constraints</span>
  <span class="c"># ---------------------------------------------------</span>
  <span class="n">problem</span> <span class="o">=</span> <span class="n">Convex</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="p">[</span>
      <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> 
      <span class="n">Σ</span> <span class="o">-</span> <span class="n">D</span>  <span class="kp">in</span> <span class="o">:</span><span class="n">SDP</span><span class="p">,</span> <span class="c"># Means Σ - D  is positive semidefinite</span>
      <span class="n">operatornorm</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">M</span> <span class="c"># Means ||X||_2 &lt;= M</span>
    <span class="p">]</span>
  <span class="p">)</span>
  
  <span class="c"># set the solver</span>
  <span class="c"># --------------</span>
  <span class="n">solver</span> <span class="o">=</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">COSMO</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
	
  <span class="c"># solve the problem</span>
  <span class="c"># -----------------</span>
  <span class="n">Convex</span><span class="o">.</span><span class="n">solve!</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">warmstart</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
  
  <span class="c"># get the optimal solution</span>
  <span class="c"># ------------------------	</span>
  <span class="n">X_sol</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">value</span>
  <span class="n">d_sol</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">value</span>
  <span class="n">opt_val</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">optval</span>
  
  <span class="c"># Compute the rank of the solution</span>
  <span class="c"># -------------------------------</span>
  <span class="n">eigvals_X</span> <span class="o">=</span> <span class="n">abs</span><span class="o">.</span><span class="p">(</span><span class="n">eigvals</span><span class="p">(</span><span class="n">X_sol</span><span class="p">))</span>

  <span class="n">rank_eigvals_X</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">eigvals_X</span> <span class="o">.&gt;</span> <span class="mi">10</span><span class="o">^-</span><span class="mi">3</span><span class="p">)</span>
	
  <span class="c"># Return the output</span>
  <span class="c"># -----------------</span>
  <span class="k">return</span> <span class="n">X_sol</span><span class="p">,</span> <span class="n">d_sol</span><span class="p">,</span> <span class="n">opt_val</span><span class="p">,</span> <span class="n">rank_eigvals_X</span>
	
<span class="k">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>minimimum_trace_factanal (generic function with 1 method)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">rank_r_sol_min_tr_factanal</span><span class="p">(</span><span class="n">Σ</span><span class="p">,</span> <span class="n">length_λ_array</span><span class="p">)</span>
  <span class="c"># Create an array of λ</span>
  <span class="n">λ_array</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">.^</span><span class="p">(</span><span class="n">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">length_λ_array</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">λ_array</span><span class="p">)</span>
    <span class="n">print</span><span class="p">(</span><span class="s">&quot;testing for λ = &quot;</span><span class="p">,</span> <span class="n">λ_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">X_sol</span><span class="p">,</span> <span class="n">d_sol</span><span class="p">,</span> <span class="n">opt_val</span><span class="p">,</span> <span class="n">rank_X</span> <span class="o">=</span> <span class="n">minimimum_trace_factanal</span><span class="p">(</span><span class="n">Σ</span><span class="p">,</span><span class="n">λ_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c"># stop if we have found a rank &lt;= r solution</span>
    <span class="n">println</span><span class="p">(</span><span class="s">&quot;, rank of X found = &quot;</span><span class="p">,</span> <span class="n">rank_X</span><span class="p">)</span>    
    <span class="k">if</span> <span class="n">rank_X</span> <span class="o">&lt;=</span> <span class="n">r</span>
      <span class="n">println</span><span class="p">(</span><span class="s">&quot;rank &lt;= </span><span class="si">$r</span><span class="s"> solution found!&quot;</span><span class="p">)</span>      
      <span class="k">return</span> <span class="n">X_sol</span><span class="p">,</span> <span class="n">d_sol</span><span class="p">,</span> <span class="n">opt_val</span><span class="p">,</span> <span class="n">rank_X</span>
      <span class="k">break</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>rank_r_sol_min_tr_factanal (generic function with 1 method)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">length_λ_array</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">X_sol</span><span class="p">,</span> <span class="n">d_sol</span><span class="p">,</span> <span class="n">opt_val</span><span class="p">,</span> <span class="n">rank_X</span> <span class="o">=</span> <span class="n">rank_r_sol_min_tr_factanal</span><span class="p">(</span><span class="n">Σ</span><span class="p">,</span> <span class="n">length_λ_array</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>testing for λ = 0.01, rank of X found = 27
testing for λ = 0.016237767391887217, rank of X found = 27
testing for λ = 0.026366508987303583, rank of X found = 27
testing for λ = 0.04281332398719394, rank of X found = 27
testing for λ = 0.06951927961775606, rank of X found = 27
testing for λ = 0.11288378916846892, rank of X found = 27
testing for λ = 0.1832980710832436, rank of X found = 28
testing for λ = 0.29763514416313186, rank of X found = 27
testing for λ = 0.4832930238571753, rank of X found = 27
testing for λ = 0.7847599703514613, rank of X found = 26
testing for λ = 1.2742749857031337, rank of X found = 15
testing for λ = 2.0691380811147897, rank of X found = 6
rank &lt;= 14.0 solution found!
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>([0.2577059748959084 -0.23529139209630925 … -0.07075099095606305 -0.09705281027755673; -0.2352913685525747 0.3062957851893959 … 0.010910499555918527 0.05913667726171187; … ; -0.07075098795841223 0.010910489888177288 … 0.13021414384393923 0.1293936312268357; -0.09705279553370942 0.059136668042670204 … 0.12939355180681217 0.15008361274853524], [0.04935669529693803; 0.0; … ; 0.0; 0.0], 31.08148496665085, 6)</pre>
</div>

</div>

</div>
</div>

</div>
 

